From b0ad9eded2a858dd7aa7814e94cafdf306ac2ff9 Mon Sep 17 00:00:00 2001
From: Alexandru Costache <alexandru@balena.io>
Date: Wed, 29 Jul 2020 16:10:14 +0200
Subject: [PATCH] Turn on led at boot

Upstream-status: Inappropriate[configuration]
Signed-off-by: Alexandru Costache <alexandru@balena.io>
---
 include/configs/imx8mm_var_dart.h | 10 ++++++++++
 1 file changed, 10 insertions(+)

diff --git a/include/configs/imx8mm_var_dart.h b/include/configs/imx8mm_var_dart.h
index 463e79d0cc..62ab827e92 100644
--- a/include/configs/imx8mm_var_dart.h
+++ b/include/configs/imx8mm_var_dart.h
@@ -116,6 +116,15 @@
 	"mmcautodetect=yes\0" \
 	"mmcpart=1\0" \
 	"m4_addr=0x7e0000\0" \
+	"led_ctrl_1=0x30\0" \
+	"led_ctrl_2=0x31\0" \
+	"led_ctrl_3=0x32\0" \
+	"select_i2c_bus_3=i2c dev 3\0" \
+	"light_red_led=i2c mw ${led_ctrl_1} 0x4 0xff\0" \
+	"light_green_led=i2c mw ${led_ctrl_1} 0x3 0xff\0" \
+	"light_yellow=run light_red_led; run light_green_led;\0" \
+	"led_enable=i2c mw ${led_ctrl_1} 0x0 0x40; i2c mw ${led_ctrl_1} 0x70 0x0; i2c mw ${led_ctrl_1} 0x8 0x1;\0" \
+	"start_led=run select_i2c_bus_3; run led_enable; run light_yellow;\0" \
 	"m4_bin=hello_world.bin\0" \
 	"use_m4=no\0" \
 	"loadm4bin=load mmc ${mmcdev}:${mmcpart} ${m4_addr} ${bootdir}/${m4_bin}\0" \
@@ -200,6 +209,7 @@
 	"splashdisable=setenv splashfile; setenv splashimage\0"
 
 #define CONFIG_BOOTCOMMAND \
+	   "run start_led; " \
 	   "run ramsize_check; " \
            "if bootswitchpos EXT; then setenv resin_flasher_skip 0; else setenv resin_flasher_skip 1; fi; "\
            "setenv resin_kernel_load_addr ${loadaddr};" \
-- 
2.17.1

